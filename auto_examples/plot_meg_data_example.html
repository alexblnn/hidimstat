<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Support recovery on MEG data &#8212; hidimstat 0.0.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          hidimstat</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="https://github.com/ja-che/hidimstat">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-meg-data-example-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="support-recovery-on-meg-data">
<span id="sphx-glr-auto-examples-plot-meg-data-example-py"></span><h1>Support recovery on MEG data<a class="headerlink" href="#support-recovery-on-meg-data" title="Permalink to this headline">¶</a></h1>
<p>This example compares several methods that recover the support in the MEG/EEG
source localization problem with statistical guarantees. Here we work
with two datasets that study three different tasks (visual, audio, somato).</p>
<p>We reproduce the real data experiment of Chevalier et al. (2020) <a class="footnote-reference brackets" href="#id2" id="id1">1</a>,
which shows the benefit of (ensemble) clustered inference such as
(ensemble of) clustered desparsified Multi-Task Lasso ((e)cd-MTLasso)
over standard approach such as sLORETA. Specifically, it retrieves
the support using a natural threshold (not computed a posteriori)
of the estimated parameter. The estimated support enjoys statistical
guarantees.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Chevalier, J. A., Gramfort, A., Salmon, J., &amp; Thirion, B. (2020).
Statistical control for spatio-temporal MEG/EEG source imaging with
desparsified multi-task Lasso. In NeurIPS 2020-34h Conference on
Neural Information Processing Systems.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.csgraph</span> <span class="k">import</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.csgraph.connected_components.html#scipy.sparse.csgraph.connected_components" title="scipy.sparse.csgraph.connected_components" class="sphx-glr-backref-module-scipy-sparse-csgraph sphx-glr-backref-type-py-function"><span class="n">connected_components</span></a>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">sample</span><span class="p">,</span> <span class="n">somato</span>
<span class="kn">from</span> <span class="nn">mne.inverse_sparse.mxne_inverse</span> <span class="k">import</span> <span class="n">_prepare_gain</span><span class="p">,</span> <span class="n">_make_sparse_stc</span>
<span class="kn">from</span> <span class="nn">mne.minimum_norm</span> <span class="k">import</span> <span class="n">make_inverse_operator</span><span class="p">,</span> <span class="n">apply_inverse</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="k">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.FeatureAgglomeration.html#sklearn.cluster.FeatureAgglomeration" title="sklearn.cluster.FeatureAgglomeration" class="sphx-glr-backref-module-sklearn-cluster sphx-glr-backref-type-py-class"><span class="n">FeatureAgglomeration</span></a>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="k">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html#sklearn.metrics.pairwise_distances" title="sklearn.metrics.pairwise_distances" class="sphx-glr-backref-module-sklearn-metrics sphx-glr-backref-type-py-function"><span class="n">pairwise_distances</span></a>

<span class="kn">from</span> <span class="nn">hidimstat.clustered_inference</span> <span class="k">import</span> <span class="n">clustered_inference</span>
<span class="kn">from</span> <span class="nn">hidimstat.ensemble_clustered_inference</span> <span class="k">import</span> \
    <span class="n">ensemble_clustered_inference</span>
<span class="kn">from</span> <span class="nn">hidimstat.stat_tools</span> <span class="k">import</span> <span class="n">zscore_from_pval</span>
</pre></div>
</div>
</section>
<section id="specific-preprocessing-functions">
<h2>Specific preprocessing functions<a class="headerlink" href="#specific-preprocessing-functions" title="Permalink to this headline">¶</a></h2>
<p>The functions below are used to load or preprocess the data or to put
the solution in a convenient format. If you are reading this example
for the first time, you should skip this section.</p>
<p>The following function loads the data from the sample dataset.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_load_sample</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load data from the sample dataset&#39;&#39;&#39;</span>

    <span class="c1"># Get data paths</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">data_path</span><span class="p">()</span>
    <span class="n">fwd_fname_suffix</span> <span class="o">=</span> <span class="s1">&#39;MEG/sample/sample_audvis-meg-eeg-oct-6-fwd.fif&#39;</span>
    <span class="n">fwd_fname</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">fwd_fname_suffix</span><span class="p">)</span>
    <span class="n">ave_fname</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;MEG/sample/sample_audvis-ave.fif&#39;</span><span class="p">)</span>
    <span class="n">cov_fname_suffix</span> <span class="o">=</span> <span class="s1">&#39;MEG/sample/sample_audvis-shrunk-cov.fif&#39;</span>
    <span class="n">cov_fname</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">cov_fname_suffix</span><span class="p">)</span>
    <span class="n">cov_fname</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">cov_fname_suffix</span>
    <span class="n">subjects_dir</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;subjects&#39;</span><span class="p">)</span>

    <span class="k">if</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;Left Auditory&#39;</span>
    <span class="k">elif</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;visual&#39;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;Left visual&#39;</span>

    <span class="c1"># Read noise covariance matrix</span>
    <span class="n">noise_cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">read_cov</span><span class="p">(</span><span class="n">cov_fname</span><span class="p">)</span>

    <span class="c1"># Read forward matrix</span>
    <span class="n">forward</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">read_forward_solution</span><span class="p">(</span><span class="n">fwd_fname</span><span class="p">)</span>

    <span class="c1"># Handling average file</span>
    <span class="n">evoked</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">read_evokeds</span><span class="p">(</span><span class="n">ave_fname</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="n">condition</span><span class="p">,</span>
                              <span class="n">baseline</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">evoked</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="s1">&#39;grad&#39;</span><span class="p">)</span>

    <span class="c1"># Selecting relevant time window</span>
    <span class="n">evoked</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span>
    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a> <span class="o">=</span> <span class="mf">0.01</span>

    <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span>
            <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="p">)</span>
</pre></div>
</div>
<p>The next function loads the data from the somato dataset.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_load_somato</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load data from the somato dataset&#39;&#39;&#39;</span>

    <span class="c1"># Get data paths</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">somato</span><span class="o">.</span><span class="n">data_path</span><span class="p">()</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
    <span class="n">subjects_dir</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/derivatives/freesurfer/subjects&#39;</span>
    <span class="n">raw_fname</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;meg&#39;</span><span class="p">,</span>
                             <span class="n">f</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">_task-</span><span class="si">{cond}</span><span class="s1">_meg.fif&#39;</span><span class="p">)</span>
    <span class="n">fwd_fname</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;derivatives&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">f</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">_task-</span><span class="si">{cond}</span><span class="s1">-fwd.fif&#39;</span><span class="p">)</span>

    <span class="c1"># Read evoked</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">find_events</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">stim_channel</span><span class="o">=</span><span class="s1">&#39;STI 014&#39;</span><span class="p">)</span>
    <span class="n">reject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="mf">350e-6</span><span class="p">)</span>
    <span class="n">picks</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">event_id</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                        <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">evoked</span> <span class="o">=</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
    <span class="n">evoked</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="s1">&#39;grad&#39;</span><span class="p">)</span>

    <span class="c1"># Compute noise covariance matrix</span>
    <span class="n">noise_cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_covariance</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="c1"># Read forward matrix</span>
    <span class="n">forward</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">read_forward_solution</span><span class="p">(</span><span class="n">fwd_fname</span><span class="p">)</span>

    <span class="c1"># Selecting relevant time window: focusing on early signal</span>
    <span class="n">evoked</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span>
    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">300</span>

    <span class="c1"># We must reduce the whitener since data were preprocessed for removal</span>
    <span class="c1"># of environmental noise with maxwell filter leading to an effective</span>
    <span class="c1"># number of 64 samples.</span>
    <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span>
            <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="p">)</span>
</pre></div>
</div>
<p>The function below preprocess the raw M/EEG data, it notably computes the
whitened MEG/EEG measurements and prepares the gain matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocess_meg_eeg_data</span><span class="p">(</span><span class="n">evoked</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                            <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Preprocess MEG or EEG data to produce the whitened MEG/EEG measurements</span>
<span class="sd">    (target) and the preprocessed gain matrix (design matrix). This function</span>
<span class="sd">    is mainly wrapping the `_prepare_gain` MNE function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    evoked : instance of mne.Evoked</span>
<span class="sd">        The evoked data.</span>

<span class="sd">    forward : instance of Forward</span>
<span class="sd">        The forward solution.</span>

<span class="sd">    noise_cov : instance of Covariance</span>
<span class="sd">        The noise covariance.</span>

<span class="sd">    loose : float in [0, 1] or &#39;auto&#39;</span>
<span class="sd">        Value that weights the source variances of the dipole components</span>
<span class="sd">        that are parallel (tangential) to the cortical surface. If loose</span>
<span class="sd">        is 0 then the solution is computed with fixed orientation.</span>
<span class="sd">        If loose is 1, it corresponds to free orientations.</span>
<span class="sd">        The default value (&#39;auto&#39;) is set to 0.2 for surface-oriented source</span>
<span class="sd">        space and set to 1.0 for volumic or discrete source space.</span>
<span class="sd">        See for details:</span>
<span class="sd">        https://mne.tools/stable/auto_tutorials/inverse/35_dipole_orientations.html?highlight=loose</span>

<span class="sd">    depth : None or float in [0, 1]</span>
<span class="sd">        Depth weighting coefficients. If None, no depth weighting is performed.</span>

<span class="sd">    pca : bool, optional (default=False)</span>
<span class="sd">        If True, whitener is reduced.</span>
<span class="sd">        If False, whitener is not reduced (square matrix).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    G : array, shape (n_channels, n_dipoles)</span>
<span class="sd">        The preprocessed gain matrix. If pca=True then n_channels is</span>
<span class="sd">        effectively equal to the rank of the data.</span>

<span class="sd">    M : array, shape (n_channels, n_times)</span>
<span class="sd">        The whitened MEG/EEG measurements. If pca=True then n_channels is</span>
<span class="sd">        effectively equal to the rank of the data.</span>

<span class="sd">    forward : instance of Forward</span>
<span class="sd">        The preprocessed forward solution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_ch_names</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">ch_names</span>

    <span class="c1"># Handle depth weighting and whitening (here is no weights)</span>
    <span class="n">forward</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">gain_info</span><span class="p">,</span> <span class="n">whitener</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a> <span class="o">=</span> \
        <span class="n">_prepare_gain</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                      <span class="n">loose</span><span class="o">=</span><span class="n">loose</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weights_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Select channels of interest</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_ch_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">gain_info</span><span class="p">[</span><span class="s1">&#39;ch_names&#39;</span><span class="p">]]</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.dot.html#numpy.dot" title="numpy.dot" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">whitener</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">forward</span>
</pre></div>
</div>
<p>The next function translates the solution in a readable format for the
MNE plotting functions that require a Source Time Course (STC) object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_compute_stc</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span> <span class="n">forward</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper of `_make_sparse_stc`&quot;&quot;&quot;</span>

    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.atleast_2d.html#numpy.atleast_2d" title="numpy.atleast_2d" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a><span class="p">)</span>

    <span class="k">if</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">T</span></a>

    <span class="n">stc</span> <span class="o">=</span> <span class="n">_make_sparse_stc</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">evoked</span><span class="o">.</span><span class="n">times</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">tstep</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">stc</span>
</pre></div>
</div>
<p>The function below will be used to modify the connectivity matrix
to avoid multiple warnings when we run the clustering algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_fix_connectivity</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">,</span> <span class="n">affinity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Complete the connectivity matrix if necessary&quot;&quot;&quot;</span>

    <span class="c1"># Convert connectivity matrix into LIL format</span>
    <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.tolil.html#scipy.sparse.coo_matrix.tolil" title="scipy.sparse.coo_matrix.tolil" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-method"><span class="n">connectivity</span><span class="o">.</span><span class="n">tolil</span></a><span class="p">()</span>

    <span class="c1"># Compute the number of nodes</span>
    <span class="n">n_connected_components</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.csgraph.connected_components.html#scipy.sparse.csgraph.connected_components" title="scipy.sparse.csgraph.connected_components" class="sphx-glr-backref-module-scipy-sparse-csgraph sphx-glr-backref-type-py-function"><span class="n">connected_components</span></a><span class="p">(</span><a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_connected_components</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_connected_components</span><span class="p">):</span>
            <span class="n">idx_i</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="numpy.where" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Xi</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><span class="n">idx_i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">idx_j</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="numpy.where" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">j</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Xj</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><span class="n">idx_j</span><span class="p">]</span>
                <span class="n">D</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html#sklearn.metrics.pairwise_distances" title="sklearn.metrics.pairwise_distances" class="sphx-glr-backref-module-sklearn-metrics sphx-glr-backref-type-py-function"><span class="n">pairwise_distances</span></a><span class="p">(</span><span class="n">Xi</span><span class="p">,</span> <span class="n">Xj</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">affinity</span><span class="p">)</span>
                <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="numpy.where" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">D</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">[</span><span class="n">idx_i</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">idx_j</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
                <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">[</span><span class="n">idx_j</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">idx_i</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">,</span> <span class="n">n_connected_components</span>
</pre></div>
</div>
</section>
<section id="downloading-data">
<h2>Downloading data<a class="headerlink" href="#downloading-data" title="Permalink to this headline">¶</a></h2>
<p>After choosing a task, we run the function that loads the data to get
the corresponding evoked, forward and noise covariance matrices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose the experiment (task)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">list_cond</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;audio&#39;</span><span class="p">,</span> <span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="s1">&#39;somato&#39;</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">list_cond</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Let&#39;s process the condition: </span><span class="si">{cond}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Load the data</span>
<span class="k">if</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;audio&#39;</span><span class="p">,</span> <span class="s1">&#39;visual&#39;</span><span class="p">]:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a> <span class="o">=</span> \
        <span class="n">_load_sample</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a><span class="p">)</span>

<span class="k">elif</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;somato&#39;</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a> <span class="o">=</span> \
        <span class="n">_load_somato</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_meg_data_example_001.png" srcset="../_images/sphx_glr_plot_meg_data_example_001.png" alt="Gradiometers (204 channels)" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Let&#39;s process the condition: somato
Using default location ~/mne_data for somato...
Creating ~/mne_data
Downloading archive MNE-somato-data.tar.gz to /home/runner/mne_data
Downloading https://files.osf.io/v1/resources/rxvq7/providers/osfstorage/59c0e2849ad5a1025d4b7346?version=7&amp;action=download&amp;direct (582.2 MB)

  0%|          | Downloading : 0.00/582M [00:00&lt;?,        ?B/s]
  0%|          | Downloading : 56.0k/582M [00:00&lt;03:48,    2.67MB/s]
  0%|          | Downloading : 216k/582M [00:00&lt;03:40,    2.77MB/s]
  0%|          | Downloading : 472k/582M [00:00&lt;03:32,    2.87MB/s]
  0%|          | Downloading : 728k/582M [00:00&lt;03:25,    2.96MB/s]
  0%|          | Downloading : 984k/582M [00:00&lt;03:19,    3.06MB/s]
  0%|          | Downloading : 1.09M/582M [00:00&lt;03:14,    3.14MB/s]
  0%|          | Downloading : 1.21M/582M [00:00&lt;03:09,    3.22MB/s]
  0%|          | Downloading : 1.46M/582M [00:00&lt;03:03,    3.32MB/s]
  0%|          | Downloading : 1.59M/582M [00:00&lt;02:59,    3.39MB/s]
  0%|          | Downloading : 1.71M/582M [00:00&lt;02:55,    3.48MB/s]
  0%|          | Downloading : 1.84M/582M [00:00&lt;02:50,    3.58MB/s]
  0%|          | Downloading : 1.96M/582M [00:00&lt;02:49,    3.60MB/s]
  0%|          | Downloading : 2.09M/582M [00:00&lt;02:47,    3.63MB/s]
  0%|          | Downloading : 2.21M/582M [00:00&lt;02:46,    3.66MB/s]
  0%|          | Downloading : 2.34M/582M [00:00&lt;02:44,    3.69MB/s]
  0%|          | Downloading : 2.46M/582M [00:00&lt;02:44,    3.70MB/s]
  0%|          | Downloading : 2.59M/582M [00:00&lt;02:41,    3.75MB/s]
  0%|          | Downloading : 2.71M/582M [00:00&lt;02:42,    3.74MB/s]
  0%|          | Downloading : 2.84M/582M [00:00&lt;02:43,    3.72MB/s]
  1%|          | Downloading : 2.96M/582M [00:00&lt;02:43,    3.71MB/s]
  1%|          | Downloading : 3.09M/582M [00:00&lt;02:44,    3.69MB/s]
  1%|          | Downloading : 3.21M/582M [00:00&lt;02:45,    3.67MB/s]
  1%|          | Downloading : 3.34M/582M [00:00&lt;02:45,    3.66MB/s]
  1%|          | Downloading : 3.46M/582M [00:00&lt;02:48,    3.60MB/s]
  1%|          | Downloading : 3.59M/582M [00:00&lt;02:48,    3.61MB/s]
  1%|          | Downloading : 3.71M/582M [00:00&lt;02:48,    3.61MB/s]
  1%|          | Downloading : 3.84M/582M [00:00&lt;02:50,    3.56MB/s]
  1%|          | Downloading : 3.96M/582M [00:00&lt;02:50,    3.55MB/s]
  1%|          | Downloading : 4.09M/582M [00:00&lt;02:52,    3.52MB/s]
  1%|          | Downloading : 4.21M/582M [00:00&lt;02:53,    3.50MB/s]
  1%|          | Downloading : 4.34M/582M [00:01&lt;02:53,    3.50MB/s]
  1%|          | Downloading : 4.46M/582M [00:01&lt;02:53,    3.48MB/s]
  1%|          | Downloading : 4.59M/582M [00:01&lt;02:54,    3.47MB/s]
  1%|          | Downloading : 4.71M/582M [00:01&lt;02:56,    3.43MB/s]
  1%|          | Downloading : 4.84M/582M [00:01&lt;02:56,    3.43MB/s]
  1%|          | Downloading : 4.96M/582M [00:01&lt;02:56,    3.43MB/s]
  1%|          | Downloading : 5.09M/582M [00:01&lt;02:56,    3.42MB/s]
  1%|          | Downloading : 5.21M/582M [00:01&lt;02:57,    3.41MB/s]
  1%|          | Downloading : 5.34M/582M [00:01&lt;02:58,    3.40MB/s]
  1%|          | Downloading : 5.46M/582M [00:01&lt;02:58,    3.39MB/s]
  1%|          | Downloading : 5.59M/582M [00:01&lt;02:59,    3.37MB/s]
  1%|          | Downloading : 5.71M/582M [00:01&lt;03:00,    3.35MB/s]
  1%|1         | Downloading : 5.84M/582M [00:01&lt;03:02,    3.32MB/s]
  1%|1         | Downloading : 5.96M/582M [00:01&lt;03:01,    3.33MB/s]
  1%|1         | Downloading : 6.09M/582M [00:01&lt;03:01,    3.33MB/s]
  1%|1         | Downloading : 6.21M/582M [00:01&lt;03:02,    3.32MB/s]
  1%|1         | Downloading : 6.34M/582M [00:01&lt;03:02,    3.32MB/s]
  1%|1         | Downloading : 6.46M/582M [00:01&lt;03:02,    3.30MB/s]
  1%|1         | Downloading : 6.59M/582M [00:01&lt;03:02,    3.30MB/s]
  1%|1         | Downloading : 6.71M/582M [00:01&lt;03:05,    3.25MB/s]
  1%|1         | Downloading : 6.84M/582M [00:01&lt;03:04,    3.27MB/s]
  1%|1         | Downloading : 6.96M/582M [00:01&lt;03:04,    3.27MB/s]
  1%|1         | Downloading : 7.09M/582M [00:01&lt;03:04,    3.27MB/s]
  1%|1         | Downloading : 7.21M/582M [00:01&lt;03:04,    3.26MB/s]
  1%|1         | Downloading : 7.34M/582M [00:01&lt;03:05,    3.26MB/s]
  1%|1         | Downloading : 7.46M/582M [00:02&lt;03:04,    3.26MB/s]
  1%|1         | Downloading : 7.59M/582M [00:02&lt;03:05,    3.24MB/s]
  1%|1         | Downloading : 7.71M/582M [00:02&lt;03:05,    3.25MB/s]
  1%|1         | Downloading : 7.84M/582M [00:02&lt;03:06,    3.23MB/s]
  1%|1         | Downloading : 7.96M/582M [00:02&lt;03:06,    3.23MB/s]
  1%|1         | Downloading : 8.09M/582M [00:02&lt;03:06,    3.22MB/s]
  1%|1         | Downloading : 8.21M/582M [00:02&lt;03:06,    3.23MB/s]
  1%|1         | Downloading : 8.34M/582M [00:02&lt;03:06,    3.23MB/s]
  1%|1         | Downloading : 8.46M/582M [00:02&lt;03:05,    3.24MB/s]
  1%|1         | Downloading : 8.59M/582M [00:02&lt;03:05,    3.24MB/s]
  1%|1         | Downloading : 8.71M/582M [00:02&lt;03:06,    3.23MB/s]
  2%|1         | Downloading : 8.84M/582M [00:02&lt;03:05,    3.23MB/s]
  2%|1         | Downloading : 8.96M/582M [00:02&lt;03:05,    3.24MB/s]
  2%|1         | Downloading : 9.09M/582M [00:02&lt;03:06,    3.23MB/s]
  2%|1         | Downloading : 9.21M/582M [00:02&lt;03:08,    3.20MB/s]
  2%|1         | Downloading : 9.34M/582M [00:02&lt;03:07,    3.21MB/s]
  2%|1         | Downloading : 9.46M/582M [00:02&lt;03:07,    3.21MB/s]
  2%|1         | Downloading : 9.59M/582M [00:02&lt;03:07,    3.21MB/s]
  2%|1         | Downloading : 9.71M/582M [00:02&lt;03:06,    3.21MB/s]
  2%|1         | Downloading : 9.84M/582M [00:02&lt;03:07,    3.21MB/s]
  2%|1         | Downloading : 9.96M/582M [00:02&lt;03:06,    3.21MB/s]
  2%|1         | Downloading : 10.1M/582M [00:02&lt;03:07,    3.19MB/s]
  2%|1         | Downloading : 10.2M/582M [00:02&lt;03:06,    3.22MB/s]
  2%|1         | Downloading : 10.3M/582M [00:02&lt;03:04,    3.24MB/s]
  2%|1         | Downloading : 10.5M/582M [00:03&lt;03:04,    3.25MB/s]
  2%|1         | Downloading : 10.6M/582M [00:03&lt;03:03,    3.26MB/s]
  2%|1         | Downloading : 10.7M/582M [00:03&lt;03:02,    3.29MB/s]
  2%|1         | Downloading : 10.8M/582M [00:03&lt;03:02,    3.28MB/s]
  2%|1         | Downloading : 11.0M/582M [00:03&lt;03:03,    3.26MB/s]
  2%|1         | Downloading : 11.1M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|1         | Downloading : 11.2M/582M [00:03&lt;03:04,    3.25MB/s]
  2%|1         | Downloading : 11.3M/582M [00:03&lt;03:04,    3.25MB/s]
  2%|1         | Downloading : 11.5M/582M [00:03&lt;03:04,    3.25MB/s]
  2%|1         | Downloading : 11.6M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 11.7M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 11.8M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 12.0M/582M [00:03&lt;03:04,    3.23MB/s]
  2%|2         | Downloading : 12.1M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 12.2M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 12.3M/582M [00:03&lt;03:05,    3.23MB/s]
  2%|2         | Downloading : 12.5M/582M [00:03&lt;03:04,    3.23MB/s]
  2%|2         | Downloading : 12.6M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 12.7M/582M [00:03&lt;03:05,    3.23MB/s]
  2%|2         | Downloading : 12.8M/582M [00:03&lt;03:05,    3.23MB/s]
  2%|2         | Downloading : 13.0M/582M [00:03&lt;03:04,    3.23MB/s]
  2%|2         | Downloading : 13.1M/582M [00:03&lt;03:05,    3.22MB/s]
  2%|2         | Downloading : 13.2M/582M [00:03&lt;03:04,    3.24MB/s]
  2%|2         | Downloading : 13.3M/582M [00:03&lt;03:02,    3.27MB/s]
  2%|2         | Downloading : 13.5M/582M [00:03&lt;03:00,    3.31MB/s]
  2%|2         | Downloading : 13.6M/582M [00:04&lt;02:58,    3.35MB/s]
  2%|2         | Downloading : 13.7M/582M [00:04&lt;02:55,    3.39MB/s]
  2%|2         | Downloading : 13.8M/582M [00:04&lt;02:53,    3.45MB/s]
  2%|2         | Downloading : 14.0M/582M [00:04&lt;02:49,    3.51MB/s]
  2%|2         | Downloading : 14.1M/582M [00:04&lt;02:46,    3.57MB/s]
  2%|2         | Downloading : 14.2M/582M [00:04&lt;02:43,    3.64MB/s]
  2%|2         | Downloading : 14.3M/582M [00:04&lt;02:40,    3.71MB/s]
  2%|2         | Downloading : 14.5M/582M [00:04&lt;02:37,    3.78MB/s]
  3%|2         | Downloading : 14.6M/582M [00:04&lt;02:34,    3.86MB/s]
  3%|2         | Downloading : 14.7M/582M [00:04&lt;02:30,    3.94MB/s]
  3%|2         | Downloading : 14.8M/582M [00:04&lt;02:27,    4.03MB/s]
  3%|2         | Downloading : 15.0M/582M [00:04&lt;02:24,    4.12MB/s]
  3%|2         | Downloading : 15.1M/582M [00:04&lt;02:21,    4.21MB/s]
  3%|2         | Downloading : 15.2M/582M [00:04&lt;02:18,    4.31MB/s]
  3%|2         | Downloading : 15.3M/582M [00:04&lt;02:15,    4.40MB/s]
  3%|2         | Downloading : 15.6M/582M [00:04&lt;02:12,    4.50MB/s]
  3%|2         | Downloading : 15.8M/582M [00:04&lt;02:08,    4.61MB/s]
  3%|2         | Downloading : 16.1M/582M [00:04&lt;02:05,    4.72MB/s]
  3%|2         | Downloading : 16.3M/582M [00:04&lt;02:02,    4.84MB/s]
  3%|2         | Downloading : 16.6M/582M [00:04&lt;01:59,    4.96MB/s]
  3%|2         | Downloading : 16.8M/582M [00:04&lt;01:56,    5.10MB/s]
  3%|2         | Downloading : 17.1M/582M [00:04&lt;01:53,    5.24MB/s]
  3%|2         | Downloading : 17.3M/582M [00:04&lt;01:50,    5.38MB/s]
  3%|3         | Downloading : 17.6M/582M [00:04&lt;01:47,    5.53MB/s]
  3%|3         | Downloading : 17.8M/582M [00:04&lt;01:44,    5.68MB/s]
  3%|3         | Downloading : 18.1M/582M [00:04&lt;01:41,    5.84MB/s]
  3%|3         | Downloading : 18.3M/582M [00:04&lt;01:38,    6.01MB/s]
  3%|3         | Downloading : 18.6M/582M [00:04&lt;01:35,    6.17MB/s]
  3%|3         | Downloading : 18.8M/582M [00:04&lt;01:33,    6.34MB/s]
  3%|3         | Downloading : 19.1M/582M [00:04&lt;01:30,    6.53MB/s]
  3%|3         | Downloading : 19.3M/582M [00:04&lt;01:27,    6.71MB/s]
  3%|3         | Downloading : 19.6M/582M [00:04&lt;01:25,    6.91MB/s]
  3%|3         | Downloading : 19.8M/582M [00:04&lt;01:23,    7.10MB/s]
  3%|3         | Downloading : 20.3M/582M [00:04&lt;01:20,    7.31MB/s]
  4%|3         | Downloading : 20.6M/582M [00:04&lt;01:18,    7.51MB/s]
  4%|3         | Downloading : 21.1M/582M [00:04&lt;01:16,    7.74MB/s]
  4%|3         | Downloading : 21.6M/582M [00:04&lt;01:13,    7.98MB/s]
  4%|3         | Downloading : 22.1M/582M [00:04&lt;01:11,    8.24MB/s]
  4%|3         | Downloading : 22.6M/582M [00:04&lt;01:09,    8.49MB/s]
  4%|3         | Downloading : 23.1M/582M [00:04&lt;01:06,    8.77MB/s]
  4%|4         | Downloading : 23.6M/582M [00:04&lt;01:04,    9.04MB/s]
  4%|4         | Downloading : 24.3M/582M [00:04&lt;01:02,    9.35MB/s]
  4%|4         | Downloading : 24.8M/582M [00:04&lt;01:00,    9.65MB/s]
  4%|4         | Downloading : 25.3M/582M [00:04&lt;00:58,    9.98MB/s]
  4%|4         | Downloading : 25.8M/582M [00:05&lt;00:56,    10.3MB/s]
  5%|4         | Downloading : 26.3M/582M [00:05&lt;00:54,    10.7MB/s]
  5%|4         | Downloading : 26.8M/582M [00:05&lt;00:52,    11.0MB/s]
  5%|4         | Downloading : 27.3M/582M [00:05&lt;00:51,    11.4MB/s]
  5%|4         | Downloading : 28.3M/582M [00:05&lt;00:49,    11.8MB/s]
  5%|4         | Downloading : 28.8M/582M [00:05&lt;00:47,    12.2MB/s]
  5%|5         | Downloading : 29.8M/582M [00:05&lt;00:45,    12.6MB/s]
  5%|5         | Downloading : 30.8M/582M [00:05&lt;00:44,    13.0MB/s]
  5%|5         | Downloading : 31.8M/582M [00:05&lt;00:42,    13.5MB/s]
  6%|5         | Downloading : 32.8M/582M [00:05&lt;00:41,    14.0MB/s]
  6%|5         | Downloading : 33.8M/582M [00:05&lt;00:39,    14.5MB/s]
  6%|6         | Downloading : 35.3M/582M [00:05&lt;00:38,    15.0MB/s]
  6%|6         | Downloading : 36.3M/582M [00:05&lt;00:36,    15.5MB/s]
  6%|6         | Downloading : 37.3M/582M [00:05&lt;00:35,    16.1MB/s]
  7%|6         | Downloading : 38.3M/582M [00:05&lt;00:34,    16.7MB/s]
  7%|6         | Downloading : 39.3M/582M [00:05&lt;00:32,    17.3MB/s]
  7%|6         | Downloading : 40.3M/582M [00:05&lt;00:31,    17.9MB/s]
  7%|7         | Downloading : 41.3M/582M [00:05&lt;00:30,    18.6MB/s]
  7%|7         | Downloading : 42.3M/582M [00:05&lt;00:29,    19.3MB/s]
  8%|7         | Downloading : 44.3M/582M [00:05&lt;00:28,    20.0MB/s]
  8%|7         | Downloading : 46.3M/582M [00:05&lt;00:27,    20.7MB/s]
  8%|8         | Downloading : 48.3M/582M [00:05&lt;00:26,    21.5MB/s]
  9%|8         | Downloading : 50.3M/582M [00:05&lt;00:24,    22.3MB/s]
  9%|8         | Downloading : 52.3M/582M [00:05&lt;00:23,    23.2MB/s]
  9%|9         | Downloading : 54.3M/582M [00:05&lt;00:22,    24.1MB/s]
 10%|9         | Downloading : 56.3M/582M [00:05&lt;00:22,    25.0MB/s]
 10%|#         | Downloading : 58.3M/582M [00:05&lt;00:21,    25.9MB/s]
 10%|#         | Downloading : 60.3M/582M [00:05&lt;00:20,    27.0MB/s]
 11%|#         | Downloading : 62.3M/582M [00:05&lt;00:19,    28.0MB/s]
 11%|#1        | Downloading : 64.3M/582M [00:05&lt;00:18,    29.1MB/s]
 11%|#1        | Downloading : 66.3M/582M [00:05&lt;00:17,    30.2MB/s]
 12%|#2        | Downloading : 70.3M/582M [00:05&lt;00:17,    31.4MB/s]
 13%|#2        | Downloading : 74.3M/582M [00:05&lt;00:16,    32.7MB/s]
 13%|#3        | Downloading : 78.3M/582M [00:05&lt;00:15,    33.9MB/s]
 14%|#3        | Downloading : 80.3M/582M [00:05&lt;00:14,    35.2MB/s]
 15%|#4        | Downloading : 86.3M/582M [00:05&lt;00:14,    36.5MB/s]
 16%|#5        | Downloading : 90.3M/582M [00:05&lt;00:13,    37.9MB/s]
 16%|#6        | Downloading : 94.3M/582M [00:05&lt;00:13,    39.3MB/s]
 17%|#6        | Downloading : 98.3M/582M [00:05&lt;00:12,    39.8MB/s]
 18%|#7        | Downloading : 102M/582M [00:06&lt;00:12,    40.9MB/s]
 18%|#8        | Downloading : 106M/582M [00:06&lt;00:12,    41.2MB/s]
 19%|#8        | Downloading : 110M/582M [00:07&lt;00:19,    25.5MB/s]
 19%|#9        | Downloading : 112M/582M [00:07&lt;00:21,    22.8MB/s]
 20%|#9        | Downloading : 115M/582M [00:07&lt;00:20,    23.4MB/s]
 20%|##        | Downloading : 117M/582M [00:07&lt;00:20,    24.2MB/s]
 20%|##        | Downloading : 119M/582M [00:07&lt;00:19,    25.0MB/s]
 21%|##        | Downloading : 121M/582M [00:07&lt;00:18,    26.0MB/s]
 21%|##1       | Downloading : 123M/582M [00:07&lt;00:17,    27.0MB/s]
 22%|##1       | Downloading : 125M/582M [00:07&lt;00:17,    28.1MB/s]
 22%|##2       | Downloading : 129M/582M [00:07&lt;00:16,    29.2MB/s]
 23%|##2       | Downloading : 131M/582M [00:07&lt;00:15,    30.4MB/s]
 23%|##3       | Downloading : 135M/582M [00:08&lt;00:14,    31.6MB/s]
 24%|##3       | Downloading : 137M/582M [00:08&lt;00:14,    32.5MB/s]
 24%|##3       | Downloading : 139M/582M [00:08&lt;00:14,    32.9MB/s]
 24%|##4       | Downloading : 141M/582M [00:08&lt;00:13,    34.1MB/s]
 25%|##5       | Downloading : 147M/582M [00:08&lt;00:13,    35.0MB/s]
 26%|##5       | Downloading : 151M/582M [00:08&lt;00:12,    36.2MB/s]
 27%|##6       | Downloading : 155M/582M [00:08&lt;00:12,    36.4MB/s]
 27%|##7       | Downloading : 159M/582M [00:08&lt;00:12,    36.6MB/s]
 28%|##8       | Downloading : 163M/582M [00:08&lt;00:11,    38.1MB/s]
 29%|##8       | Downloading : 167M/582M [00:08&lt;00:10,    39.6MB/s]
 29%|##9       | Downloading : 171M/582M [00:08&lt;00:10,    41.1MB/s]
 30%|###       | Downloading : 175M/582M [00:08&lt;00:10,    42.6MB/s]
 31%|###       | Downloading : 179M/582M [00:08&lt;00:11,    37.6MB/s]
 31%|###1      | Downloading : 181M/582M [00:09&lt;00:14,    29.5MB/s]
 31%|###1      | Downloading : 182M/582M [00:09&lt;00:14,    29.6MB/s]
 31%|###1      | Downloading : 183M/582M [00:09&lt;00:13,    30.0MB/s]
 32%|###1      | Downloading : 185M/582M [00:09&lt;00:13,    31.1MB/s]
 32%|###2      | Downloading : 187M/582M [00:09&lt;00:12,    31.9MB/s]
 33%|###2      | Downloading : 189M/582M [00:09&lt;00:12,    33.0MB/s]
 33%|###2      | Downloading : 191M/582M [00:09&lt;00:12,    33.8MB/s]
 33%|###3      | Downloading : 193M/582M [00:09&lt;00:11,    34.7MB/s]
 34%|###3      | Downloading : 195M/582M [00:09&lt;00:11,    35.8MB/s]
 34%|###3      | Downloading : 197M/582M [00:09&lt;00:10,    36.8MB/s]
 34%|###4      | Downloading : 199M/582M [00:09&lt;00:10,    37.8MB/s]
 35%|###4      | Downloading : 201M/582M [00:09&lt;00:10,    38.8MB/s]
 35%|###4      | Downloading : 203M/582M [00:09&lt;00:09,    40.0MB/s]
 35%|###5      | Downloading : 205M/582M [00:09&lt;00:09,    41.0MB/s]
 36%|###5      | Downloading : 207M/582M [00:09&lt;00:09,    41.8MB/s]
 36%|###5      | Downloading : 209M/582M [00:09&lt;00:09,    42.2MB/s]
 36%|###6      | Downloading : 211M/582M [00:09&lt;00:08,    43.2MB/s]
 37%|###6      | Downloading : 215M/582M [00:09&lt;00:08,    44.4MB/s]
 38%|###7      | Downloading : 219M/582M [00:09&lt;00:08,    45.1MB/s]
 38%|###8      | Downloading : 221M/582M [00:09&lt;00:08,    45.8MB/s]
 38%|###8      | Downloading : 223M/582M [00:09&lt;00:08,    45.1MB/s]
 39%|###8      | Downloading : 225M/582M [00:10&lt;00:08,    43.7MB/s]
 39%|###9      | Downloading : 227M/582M [00:10&lt;00:08,    44.9MB/s]
 39%|###9      | Downloading : 229M/582M [00:10&lt;00:08,    45.0MB/s]
 40%|###9      | Downloading : 231M/582M [00:10&lt;00:08,    45.5MB/s]
 40%|####      | Downloading : 233M/582M [00:10&lt;00:07,    47.0MB/s]
 41%|####      | Downloading : 237M/582M [00:10&lt;00:07,    48.2MB/s]
 41%|####1     | Downloading : 239M/582M [00:10&lt;00:07,    47.6MB/s]
 41%|####1     | Downloading : 241M/582M [00:10&lt;00:07,    47.4MB/s]
 42%|####1     | Downloading : 243M/582M [00:10&lt;00:07,    48.6MB/s]
 42%|####2     | Downloading : 245M/582M [00:10&lt;00:07,    46.7MB/s]
 42%|####2     | Downloading : 247M/582M [00:10&lt;00:08,    43.8MB/s]
 43%|####2     | Downloading : 248M/582M [00:10&lt;00:07,    44.1MB/s]
 43%|####3     | Downloading : 251M/582M [00:10&lt;00:07,    45.4MB/s]
 44%|####3     | Downloading : 253M/582M [00:10&lt;00:07,    46.7MB/s]
 44%|####3     | Downloading : 255M/582M [00:10&lt;00:07,    47.9MB/s]
 45%|####4     | Downloading : 259M/582M [00:10&lt;00:06,    49.5MB/s]
 45%|####5     | Downloading : 263M/582M [00:10&lt;00:06,    50.9MB/s]
 46%|####5     | Downloading : 265M/582M [00:10&lt;00:06,    51.7MB/s]
 46%|####5     | Downloading : 267M/582M [00:10&lt;00:06,    52.8MB/s]
 46%|####6     | Downloading : 269M/582M [00:10&lt;00:06,    54.2MB/s]
 47%|####6     | Downloading : 271M/582M [00:10&lt;00:05,    54.8MB/s]
 47%|####6     | Downloading : 273M/582M [00:10&lt;00:05,    56.3MB/s]
 47%|####7     | Downloading : 275M/582M [00:10&lt;00:05,    57.4MB/s]
 48%|####7     | Downloading : 277M/582M [00:10&lt;00:05,    58.1MB/s]
 48%|####7     | Downloading : 279M/582M [00:10&lt;00:05,    59.1MB/s]
 48%|####8     | Downloading : 281M/582M [00:10&lt;00:05,    60.5MB/s]
 49%|####8     | Downloading : 283M/582M [00:10&lt;00:05,    61.8MB/s]
 49%|####9     | Downloading : 285M/582M [00:10&lt;00:04,    62.7MB/s]
 49%|####9     | Downloading : 287M/582M [00:10&lt;00:04,    63.6MB/s]
 50%|#####     | Downloading : 291M/582M [00:10&lt;00:04,    65.2MB/s]
 50%|#####     | Downloading : 293M/582M [00:10&lt;00:04,    66.3MB/s]
 51%|#####     | Downloading : 295M/582M [00:11&lt;00:04,    67.3MB/s]
 51%|#####1    | Downloading : 297M/582M [00:11&lt;00:04,    67.4MB/s]
 51%|#####1    | Downloading : 299M/582M [00:11&lt;00:04,    68.4MB/s]
 52%|#####1    | Downloading : 301M/582M [00:11&lt;00:04,    70.0MB/s]
 52%|#####2    | Downloading : 303M/582M [00:11&lt;00:04,    71.0MB/s]
 53%|#####2    | Downloading : 307M/582M [00:11&lt;00:03,    72.9MB/s]
 53%|#####3    | Downloading : 309M/582M [00:11&lt;00:03,    74.1MB/s]
 53%|#####3    | Downloading : 311M/582M [00:11&lt;00:03,    75.0MB/s]
 54%|#####3    | Downloading : 313M/582M [00:11&lt;00:03,    71.1MB/s]
 54%|#####4    | Downloading : 315M/582M [00:11&lt;00:05,    53.6MB/s]
 54%|#####4    | Downloading : 316M/582M [00:11&lt;00:06,    42.5MB/s]
 54%|#####4    | Downloading : 317M/582M [00:11&lt;00:10,    27.5MB/s]
 54%|#####4    | Downloading : 317M/582M [00:11&lt;00:11,    23.8MB/s]
 55%|#####4    | Downloading : 317M/582M [00:11&lt;00:13,    20.4MB/s]
 55%|#####4    | Downloading : 318M/582M [00:11&lt;00:14,    19.0MB/s]
 55%|#####4    | Downloading : 318M/582M [00:11&lt;00:15,    18.0MB/s]
 55%|#####4    | Downloading : 318M/582M [00:11&lt;00:15,    17.5MB/s]
 55%|#####4    | Downloading : 318M/582M [00:11&lt;00:16,    16.9MB/s]
 55%|#####4    | Downloading : 319M/582M [00:11&lt;00:16,    16.3MB/s]
 55%|#####4    | Downloading : 319M/582M [00:11&lt;00:17,    15.7MB/s]
 55%|#####4    | Downloading : 319M/582M [00:11&lt;00:17,    15.5MB/s]
 55%|#####4    | Downloading : 319M/582M [00:12&lt;00:18,    15.3MB/s]
 55%|#####4    | Downloading : 320M/582M [00:12&lt;00:18,    14.5MB/s]
 55%|#####4    | Downloading : 320M/582M [00:12&lt;00:20,    13.3MB/s]
 55%|#####4    | Downloading : 320M/582M [00:12&lt;00:20,    13.1MB/s]
 55%|#####5    | Downloading : 320M/582M [00:12&lt;00:21,    12.8MB/s]
 55%|#####5    | Downloading : 321M/582M [00:12&lt;00:21,    12.8MB/s]
 55%|#####5    | Downloading : 321M/582M [00:12&lt;00:21,    12.8MB/s]
 55%|#####5    | Downloading : 321M/582M [00:12&lt;00:21,    12.7MB/s]
 55%|#####5    | Downloading : 321M/582M [00:12&lt;00:22,    12.2MB/s]
 55%|#####5    | Downloading : 322M/582M [00:12&lt;00:22,    12.2MB/s]
 55%|#####5    | Downloading : 322M/582M [00:12&lt;00:23,    11.8MB/s]
 55%|#####5    | Downloading : 322M/582M [00:12&lt;00:23,    11.7MB/s]
 55%|#####5    | Downloading : 322M/582M [00:12&lt;00:23,    11.8MB/s]
 55%|#####5    | Downloading : 323M/582M [00:12&lt;00:24,    11.2MB/s]
 55%|#####5    | Downloading : 323M/582M [00:12&lt;00:24,    11.2MB/s]
 55%|#####5    | Downloading : 323M/582M [00:12&lt;00:23,    11.3MB/s]
 56%|#####5    | Downloading : 323M/582M [00:12&lt;00:25,    10.7MB/s]
 56%|#####5    | Downloading : 324M/582M [00:12&lt;00:25,    10.5MB/s]
 56%|#####5    | Downloading : 324M/582M [00:12&lt;00:25,    10.6MB/s]
 56%|#####5    | Downloading : 324M/582M [00:12&lt;00:25,    10.6MB/s]
 56%|#####5    | Downloading : 324M/582M [00:12&lt;00:27,    9.91MB/s]
 56%|#####5    | Downloading : 325M/582M [00:12&lt;00:28,    9.62MB/s]
 56%|#####5    | Downloading : 325M/582M [00:12&lt;00:29,    9.29MB/s]
 56%|#####5    | Downloading : 325M/582M [00:12&lt;00:28,    9.44MB/s]
 56%|#####5    | Downloading : 325M/582M [00:12&lt;00:28,    9.47MB/s]
 56%|#####5    | Downloading : 326M/582M [00:12&lt;00:29,    9.19MB/s]
 56%|#####5    | Downloading : 326M/582M [00:12&lt;00:30,    8.83MB/s]
 56%|#####6    | Downloading : 326M/582M [00:12&lt;00:31,    8.58MB/s]
 56%|#####6    | Downloading : 326M/582M [00:12&lt;00:31,    8.64MB/s]
 56%|#####6    | Downloading : 327M/582M [00:12&lt;00:32,    8.33MB/s]
 56%|#####6    | Downloading : 327M/582M [00:13&lt;00:32,    8.23MB/s]
 56%|#####6    | Downloading : 327M/582M [00:13&lt;00:33,    7.90MB/s]
 56%|#####6    | Downloading : 327M/582M [00:13&lt;00:34,    7.83MB/s]
 56%|#####6    | Downloading : 328M/582M [00:13&lt;00:33,    7.95MB/s]
 56%|#####6    | Downloading : 328M/582M [00:13&lt;00:33,    7.93MB/s]
 56%|#####6    | Downloading : 328M/582M [00:13&lt;00:33,    7.93MB/s]
 56%|#####6    | Downloading : 328M/582M [00:13&lt;00:33,    8.05MB/s]
 56%|#####6    | Downloading : 329M/582M [00:13&lt;00:32,    8.23MB/s]
 56%|#####6    | Downloading : 329M/582M [00:13&lt;00:31,    8.39MB/s]
 57%|#####6    | Downloading : 329M/582M [00:13&lt;00:30,    8.58MB/s]
 57%|#####6    | Downloading : 329M/582M [00:13&lt;00:30,    8.66MB/s]
 57%|#####6    | Downloading : 330M/582M [00:13&lt;00:30,    8.81MB/s]
 57%|#####6    | Downloading : 330M/582M [00:13&lt;00:29,    8.93MB/s]
 57%|#####6    | Downloading : 330M/582M [00:13&lt;00:29,    8.93MB/s]
 57%|#####6    | Downloading : 330M/582M [00:13&lt;00:29,    9.07MB/s]
 57%|#####6    | Downloading : 331M/582M [00:13&lt;00:28,    9.13MB/s]
 57%|#####6    | Downloading : 331M/582M [00:13&lt;00:29,    8.97MB/s]
 57%|#####6    | Downloading : 331M/582M [00:13&lt;00:29,    8.85MB/s]
 57%|#####6    | Downloading : 331M/582M [00:13&lt;00:29,    8.88MB/s]
 57%|#####6    | Downloading : 332M/582M [00:13&lt;00:29,    9.06MB/s]
 57%|#####6    | Downloading : 332M/582M [00:13&lt;00:28,    9.21MB/s]
 57%|#####7    | Downloading : 332M/582M [00:13&lt;00:27,    9.40MB/s]
 57%|#####7    | Downloading : 332M/582M [00:13&lt;00:27,    9.55MB/s]
 57%|#####7    | Downloading : 333M/582M [00:13&lt;00:27,    9.67MB/s]
 57%|#####7    | Downloading : 333M/582M [00:13&lt;00:26,    9.89MB/s]
 57%|#####7    | Downloading : 333M/582M [00:13&lt;00:25,    10.1MB/s]
 57%|#####7    | Downloading : 334M/582M [00:13&lt;00:25,    10.3MB/s]
 57%|#####7    | Downloading : 334M/582M [00:13&lt;00:24,    10.4MB/s]
 58%|#####7    | Downloading : 335M/582M [00:13&lt;00:24,    10.7MB/s]
 58%|#####8    | Downloading : 339M/582M [00:13&lt;00:22,    11.2MB/s]
 59%|#####8    | Downloading : 343M/582M [00:13&lt;00:21,    11.8MB/s]
 59%|#####9    | Downloading : 345M/582M [00:13&lt;00:20,    12.4MB/s]
 60%|#####9    | Downloading : 347M/582M [00:13&lt;00:19,    12.9MB/s]
 60%|#####9    | Downloading : 349M/582M [00:13&lt;00:18,    13.5MB/s]
 61%|######    | Downloading : 355M/582M [00:13&lt;00:16,    14.1MB/s]
 62%|######1   | Downloading : 359M/582M [00:14&lt;00:16,    14.4MB/s]
 62%|######1   | Downloading : 361M/582M [00:14&lt;00:15,    15.0MB/s]
 62%|######2   | Downloading : 363M/582M [00:14&lt;00:14,    15.4MB/s]
 63%|######2   | Downloading : 365M/582M [00:14&lt;00:14,    15.8MB/s]
 63%|######2   | Downloading : 367M/582M [00:14&lt;00:13,    16.2MB/s]
 63%|######3   | Downloading : 369M/582M [00:14&lt;00:13,    16.8MB/s]
 64%|######3   | Downloading : 371M/582M [00:14&lt;00:12,    17.5MB/s]
 64%|######3   | Downloading : 373M/582M [00:14&lt;00:12,    18.3MB/s]
 64%|######4   | Downloading : 375M/582M [00:14&lt;00:11,    19.0MB/s]
 65%|######5   | Downloading : 379M/582M [00:14&lt;00:10,    19.8MB/s]
 65%|######5   | Downloading : 381M/582M [00:14&lt;00:10,    20.5MB/s]
 66%|######5   | Downloading : 383M/582M [00:14&lt;00:09,    21.3MB/s]
 66%|######6   | Downloading : 385M/582M [00:14&lt;00:09,    22.2MB/s]
 66%|######6   | Downloading : 387M/582M [00:14&lt;00:08,    23.0MB/s]
 67%|######6   | Downloading : 389M/582M [00:14&lt;00:08,    23.7MB/s]
 67%|######7   | Downloading : 391M/582M [00:14&lt;00:08,    24.7MB/s]
 68%|######7   | Downloading : 395M/582M [00:14&lt;00:07,    25.7MB/s]
 68%|######8   | Downloading : 397M/582M [00:14&lt;00:07,    26.6MB/s]
 69%|######8   | Downloading : 401M/582M [00:14&lt;00:07,    26.8MB/s]
 69%|######9   | Downloading : 404M/582M [00:14&lt;00:06,    28.0MB/s]
 70%|######9   | Downloading : 406M/582M [00:14&lt;00:06,    29.0MB/s]
 70%|#######   | Downloading : 408M/582M [00:14&lt;00:06,    29.9MB/s]
 70%|#######   | Downloading : 410M/582M [00:14&lt;00:05,    30.9MB/s]
 71%|#######   | Downloading : 412M/582M [00:14&lt;00:05,    32.1MB/s]
 71%|#######1  | Downloading : 414M/582M [00:15&lt;00:05,    33.3MB/s]
 72%|#######1  | Downloading : 418M/582M [00:15&lt;00:05,    33.4MB/s]
 72%|#######2  | Downloading : 420M/582M [00:15&lt;00:04,    34.7MB/s]
 72%|#######2  | Downloading : 422M/582M [00:15&lt;00:04,    35.9MB/s]
 73%|#######3  | Downloading : 428M/582M [00:15&lt;00:04,    36.9MB/s]
 74%|#######4  | Downloading : 432M/582M [00:15&lt;00:04,    38.2MB/s]
 75%|#######4  | Downloading : 436M/582M [00:15&lt;00:04,    34.7MB/s]
 75%|#######5  | Downloading : 438M/582M [00:15&lt;00:04,    31.8MB/s]
 75%|#######5  | Downloading : 439M/582M [00:15&lt;00:04,    31.0MB/s]
 76%|#######5  | Downloading : 440M/582M [00:15&lt;00:04,    31.5MB/s]
 76%|#######5  | Downloading : 441M/582M [00:15&lt;00:04,    32.4MB/s]
 76%|#######6  | Downloading : 444M/582M [00:15&lt;00:04,    33.5MB/s]
 77%|#######6  | Downloading : 446M/582M [00:15&lt;00:04,    33.3MB/s]
 77%|#######6  | Downloading : 448M/582M [00:15&lt;00:04,    34.1MB/s]
 77%|#######7  | Downloading : 450M/582M [00:16&lt;00:03,    35.2MB/s]
 78%|#######7  | Downloading : 454M/582M [00:16&lt;00:03,    36.3MB/s]
 78%|#######8  | Downloading : 456M/582M [00:16&lt;00:03,    37.6MB/s]
 79%|#######8  | Downloading : 458M/582M [00:16&lt;00:03,    35.9MB/s]
 79%|#######9  | Downloading : 461M/582M [00:16&lt;00:03,    37.1MB/s]
 79%|#######9  | Downloading : 463M/582M [00:16&lt;00:03,    37.7MB/s]
 80%|#######9  | Downloading : 465M/582M [00:16&lt;00:03,    36.6MB/s]
 80%|########  | Downloading : 467M/582M [00:16&lt;00:03,    37.7MB/s]
 80%|########  | Downloading : 469M/582M [00:16&lt;00:03,    38.7MB/s]
 81%|########  | Downloading : 471M/582M [00:16&lt;00:02,    40.0MB/s]
 81%|########1 | Downloading : 473M/582M [00:16&lt;00:02,    40.4MB/s]
 82%|########1 | Downloading : 475M/582M [00:16&lt;00:02,    41.2MB/s]
 82%|########1 | Downloading : 477M/582M [00:16&lt;00:02,    42.4MB/s]
 82%|########2 | Downloading : 479M/582M [00:16&lt;00:02,    42.2MB/s]
 83%|########2 | Downloading : 481M/582M [00:16&lt;00:02,    42.4MB/s]
 83%|########2 | Downloading : 483M/582M [00:16&lt;00:02,    39.2MB/s]
 83%|########3 | Downloading : 484M/582M [00:16&lt;00:02,    38.0MB/s]
 83%|########3 | Downloading : 485M/582M [00:16&lt;00:02,    38.5MB/s]
 83%|########3 | Downloading : 486M/582M [00:16&lt;00:02,    39.1MB/s]
 84%|########3 | Downloading : 487M/582M [00:16&lt;00:02,    38.0MB/s]
 84%|########3 | Downloading : 488M/582M [00:16&lt;00:02,    38.2MB/s]
 84%|########3 | Downloading : 489M/582M [00:16&lt;00:02,    38.0MB/s]
 84%|########4 | Downloading : 490M/582M [00:16&lt;00:02,    38.5MB/s]
 84%|########4 | Downloading : 492M/582M [00:16&lt;00:02,    39.0MB/s]
 85%|########4 | Downloading : 493M/582M [00:17&lt;00:02,    38.6MB/s]
 85%|########4 | Downloading : 494M/582M [00:17&lt;00:02,    38.8MB/s]
 85%|########4 | Downloading : 495M/582M [00:17&lt;00:02,    38.4MB/s]
 85%|########5 | Downloading : 496M/582M [00:17&lt;00:02,    38.8MB/s]
 85%|########5 | Downloading : 497M/582M [00:17&lt;00:02,    39.3MB/s]
 85%|########5 | Downloading : 498M/582M [00:17&lt;00:02,    39.8MB/s]
 86%|########5 | Downloading : 499M/582M [00:17&lt;00:02,    40.6MB/s]
 86%|########6 | Downloading : 502M/582M [00:17&lt;00:02,    42.1MB/s]
 86%|########6 | Downloading : 504M/582M [00:17&lt;00:01,    42.7MB/s]
 87%|########6 | Downloading : 506M/582M [00:17&lt;00:01,    42.8MB/s]
 87%|########7 | Downloading : 508M/582M [00:17&lt;00:01,    43.0MB/s]
 88%|########7 | Downloading : 510M/582M [00:17&lt;00:01,    44.0MB/s]
 88%|########7 | Downloading : 512M/582M [00:17&lt;00:01,    45.4MB/s]
 88%|########8 | Downloading : 514M/582M [00:17&lt;00:01,    46.9MB/s]
 89%|########8 | Downloading : 516M/582M [00:17&lt;00:01,    47.8MB/s]
 89%|########8 | Downloading : 518M/582M [00:17&lt;00:01,    49.3MB/s]
 90%|########9 | Downloading : 522M/582M [00:17&lt;00:01,    50.9MB/s]
 90%|########9 | Downloading : 524M/582M [00:17&lt;00:01,    51.4MB/s]
 90%|######### | Downloading : 526M/582M [00:17&lt;00:01,    52.2MB/s]
 91%|######### | Downloading : 528M/582M [00:17&lt;00:01,    52.8MB/s]
 91%|######### | Downloading : 530M/582M [00:17&lt;00:01,    53.1MB/s]
 91%|#########1| Downloading : 532M/582M [00:17&lt;00:00,    53.4MB/s]
 92%|#########1| Downloading : 534M/582M [00:17&lt;00:00,    53.0MB/s]
 92%|#########1| Downloading : 536M/582M [00:17&lt;00:00,    54.1MB/s]
 92%|#########2| Downloading : 538M/582M [00:17&lt;00:00,    55.2MB/s]
 93%|#########2| Downloading : 540M/582M [00:17&lt;00:00,    55.8MB/s]
 93%|#########3| Downloading : 542M/582M [00:17&lt;00:00,    57.0MB/s]
 93%|#########3| Downloading : 544M/582M [00:17&lt;00:00,    58.3MB/s]
 94%|#########3| Downloading : 546M/582M [00:17&lt;00:00,    59.4MB/s]
 94%|#########4| Downloading : 548M/582M [00:17&lt;00:00,    60.4MB/s]
 95%|#########4| Downloading : 552M/582M [00:17&lt;00:00,    62.2MB/s]
 95%|#########5| Downloading : 554M/582M [00:17&lt;00:00,    62.8MB/s]
 95%|#########5| Downloading : 556M/582M [00:17&lt;00:00,    63.8MB/s]
 96%|#########5| Downloading : 558M/582M [00:17&lt;00:00,    64.7MB/s]
 96%|#########6| Downloading : 562M/582M [00:17&lt;00:00,    66.6MB/s]
 97%|#########6| Downloading : 564M/582M [00:17&lt;00:00,    68.1MB/s]
 97%|#########7| Downloading : 568M/582M [00:17&lt;00:00,    69.9MB/s]
 98%|#########7| Downloading : 570M/582M [00:18&lt;00:00,    64.0MB/s]
 98%|#########8| Downloading : 572M/582M [00:18&lt;00:00,    63.9MB/s]
 99%|#########8| Downloading : 574M/582M [00:18&lt;00:00,    64.8MB/s]
 99%|#########8| Downloading : 576M/582M [00:18&lt;00:00,    64.8MB/s]
 99%|#########9| Downloading : 578M/582M [00:18&lt;00:00,    63.8MB/s]
100%|#########9| Downloading : 580M/582M [00:18&lt;00:00,    63.5MB/s]
100%|#########9| Downloading : 582M/582M [00:18&lt;00:00,    64.9MB/s]
100%|##########| Downloading : 582M/582M [00:18&lt;00:00,    33.4MB/s]
Verifying hash 32fd2f6c8c7eb0784a1de6435273c48b.
Decompressing the archive: /home/runner/mne_data/MNE-somato-data.tar.gz
(please be patient, this can take some time)
Successfully extracted to: [&#39;/home/runner/mne_data/MNE-somato-data&#39;]
Attempting to create new mne-python configuration file:
/home/runner/.mne/mne-python.json
Opening raw data file /home/runner/mne_data/MNE-somato-data/sub-01/meg/sub-01_task-somato_meg.fif...
    Range : 237600 ... 506999 =    791.189 ...  1688.266 secs
Ready.
111 events found
Event IDs: [1]
Not setting metadata
Not setting metadata
111 matching events found
Setting baseline interval to [-0.19979521315838786, 0.0] sec
Applying baseline correction (mode: mean)
0 projection items activated
Loading data for 111 events and 136 original time points ...
0 bad epochs dropped
Computing rank from data with rank=&#39;info&#39;
    MEG: rank 64 after 0 projectors applied to 306 channels
    Setting small MEG eigenvalues to zero (without PCA)
Reducing data rank from 306 -&gt; 64
Estimating covariance using EMPIRICAL
Done.
Number of samples used : 6771
[done]
Reading forward solution from /home/runner/mne_data/MNE-somato-data/derivatives/sub-01/sub-01_task-somato-fwd.fif...
    Reading a source space...
    [done]
    Reading a source space...
    [done]
    2 source spaces read
    Desired named matrix (kind = 3523) not available
    Read MEG forward solution (8155 sources, 306 channels, free orientations)
    Source spaces transformed to the forward solution coordinate frame
</pre></div>
</div>
</section>
<section id="preparing-data-for-clustered-inference">
<h2>Preparing data for clustered inference<a class="headerlink" href="#preparing-data-for-clustered-inference" title="Permalink to this headline">¶</a></h2>
<p>For clustered inference we need the targets <code class="docutils literal notranslate"><span class="pre">Y</span></code>, the design matrix <code class="docutils literal notranslate"><span class="pre">X</span></code>
and the <code class="docutils literal notranslate"><span class="pre">connectivity</span></code> matrix, which is a sparse adjacency matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collecting features&#39; connectivity</span>
<a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">source_estimate</span><span class="o">.</span><span class="n">spatial_src_adjacency</span><span class="p">(</span><span class="n">forward</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">])</span>

<span class="c1"># Croping evoked according to relevant time window</span>
<span class="n">evoked</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_max</span></a><span class="p">)</span>

<span class="c1"># Choosing frequency and number of clusters used for compression.</span>
<span class="c1"># Reducing the frequency to 100Hz to make inference faster</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">step</span></a> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a> <span class="o">*</span> <span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">])</span>
<span class="n">evoked</span><span class="o">.</span><span class="n">decimate</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">step</span></a><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">t_min</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">evoked</span><span class="o">.</span><span class="n">times</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_step</span></a> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">]</span>

<span class="c1"># Preprocessing MEG data</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Y</span></a><span class="p">,</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">preprocess_meg_eeg_data</span><span class="p">(</span><span class="n">evoked</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pca</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-- number of adjacent vertices : 8196
/home/runner/work/hidimstat/hidimstat/examples/plot_meg_data_example.py:287: RuntimeWarning: 0.5% of original source space vertices have been omitted, tri-based adjacency will have holes.
Consider using distance-based adjacency or morphing data to all source space vertices.
  connectivity = mne.source_estimate.spatial_src_adjacency(forward[&#39;src&#39;])
Converting forward solution to fixed orietnation
    No patch info available. The standard source space normals will be employed in the rotation to the local surface coordinates....
    Changing to fixed-orientation forward solution with surface-based source orientations...
    [done]
Computing inverse operator with 204 channels.
    204 out of 306 channels remain after picking
Selected 204 channels
Whitening the forward solution.
Computing rank from covariance with rank=None
    Using tolerance 2.1e-12 (2.2e-16 eps * 204 dim * 46  max singular value)
    Estimated rank (grad): 64
    GRAD: rank 64 computed from 204 data channels with 0 projectors
    Setting small GRAD eigenvalues to zero (without PCA)
Creating the source covariance matrix
Adjusting source covariance matrix.
</pre></div>
</div>
</section>
<section id="running-clustered-inference">
<h2>Running clustered inference<a class="headerlink" href="#running-clustered-inference" title="Permalink to this headline">¶</a></h2>
<p>For MEG data <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">=</span> <span class="pre">1000</span></code> is generally a good default choice.
Taking <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">&gt;</span> <span class="pre">2000</span></code> might lead to an unpowerful inference.
Taking <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">&lt;</span> <span class="pre">500</span></code> might compress too much the data leading
to a compressed problem not close enough to the original problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Setting theoretical FWER target</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Computing threshold taking into account for Bonferroni correction</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">correction_clust_inf</span></a> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold</span></a> <span class="o">=</span> <span class="n">zscore_from_pval</span><span class="p">((</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">correction_clust_inf</span></a><span class="p">)</span>

<span class="c1"># Initializing FeatureAgglomeration object used for the clustering step</span>
<a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.lil_matrix.html#scipy.sparse.lil_matrix" title="scipy.sparse.lil_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity_fixed</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a> <span class="o">=</span> \
    <span class="n">_fix_connectivity</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">T</span></a><span class="p">,</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">)</span>
<a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.FeatureAgglomeration.html#sklearn.cluster.FeatureAgglomeration" title="sklearn.cluster.FeatureAgglomeration" class="sphx-glr-backref-module-sklearn-cluster sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ward</span></a> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.FeatureAgglomeration.html#sklearn.cluster.FeatureAgglomeration" title="sklearn.cluster.FeatureAgglomeration" class="sphx-glr-backref-module-sklearn-cluster sphx-glr-backref-type-py-class"><span class="n">FeatureAgglomeration</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a><span class="p">,</span> <a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="o">=</span><a href="https://scipy.github.io/devdocs/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix" title="scipy.sparse.coo_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">connectivity</span></a><span class="p">)</span>

<span class="c1"># Making the inference with the clustered inference algorithm</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inference_method</span></a> <span class="o">=</span> <span class="s1">&#39;desparsified-group-lasso&#39;</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">beta_hat</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval_corr</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval_corr</span></a> <span class="o">=</span> \
    <span class="n">clustered_inference</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Y</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.FeatureAgglomeration.html#sklearn.cluster.FeatureAgglomeration" title="sklearn.cluster.FeatureAgglomeration" class="sphx-glr-backref-module-sklearn-cluster sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ward</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a><span class="p">,</span> <span class="n">method</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inference_method</span></a><span class="p">)</span>

<span class="c1"># Extracting active set (support)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval_corr</span></a> <span class="o">&lt;</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                           <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval_corr</span></a> <span class="o">&lt;</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set_full</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.copy.html#numpy.copy" title="numpy.copy" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">copy</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set_full</span></a><span class="p">[:]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Translating p-vals into z-scores for nicer visualization</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore</span></a> <span class="o">=</span> <span class="n">zscore_from_pval</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval</span></a><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore</span></a><span class="p">[</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Clustered inference: n_clusters = 1000, inference method = desparsified-group-lasso, seed = 0
/home/runner/.local/lib/python3.8/site-packages/sklearn/cluster/_agglomerative.py:245: UserWarning: the number of connected components of the connectivity matrix is 2 &gt; 1. Completing it to avoid stopping the tree early.
  connectivity, n_connected_components = _fix_connectivity(
/home/runner/work/hidimstat/hidimstat/hidimstat/desparsified_lasso.py:32: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  results = np.asarray(results)
Group reid: AR1 cov estimation
</pre></div>
</div>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>Now, let us plot the thresholded statistical maps derived thanks to the
clustered inference algorithm referred as cd-MTLasso.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s put the solution into the format supported by the plotting functions</span>
<span class="n">stc</span> <span class="o">=</span> <span class="n">_compute_stc</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span> <span class="n">forward</span><span class="p">)</span>

<span class="c1"># Plotting parameters</span>
<span class="k">if</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a> <span class="o">=</span> <span class="s1">&#39;lh&#39;</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a> <span class="o">=</span> <span class="s1">&#39;lateral&#39;</span>
<span class="k">elif</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;visual&#39;</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a> <span class="o">=</span> <span class="s1">&#39;rh&#39;</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a> <span class="o">=</span> <span class="s1">&#39;medial&#39;</span>
<span class="k">elif</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cond</span></a> <span class="o">==</span> <span class="s1">&#39;somato&#39;</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a> <span class="o">=</span> <span class="s1">&#39;rh&#39;</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a> <span class="o">=</span> <span class="s1">&#39;lateral&#39;</span>

<span class="c1"># Plotting clustered inference solution</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">set_3d_backend</span><span class="p">(</span><span class="s2">&quot;pyvista&quot;</span><span class="p">)</span>

<span class="k">if</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><span class="n">stc</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pos_lims</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span>
                     <span class="n">time_viewer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">brain</span><span class="o">.</span><span class="n">show_view</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a><span class="p">)</span>
    <span class="n">brain</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{cond}</span><span class="s1"> - cd-MTLasso (AR1)&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
                   <span class="n">font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">save_fig</span></a> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">save_fig</span></a><span class="p">:</span>
    <span class="n">brain</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="s1">&#39;figures/meg_audio_cd-MTLasso.png&#39;</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">interactive_plot</span></a> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">interactive_plot</span></a><span class="p">:</span>
    <span class="n">brain</span> <span class="o">=</span> \
        <span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_meg_data_example_002.png" srcset="../_images/sphx_glr_plot_meg_data_example_002.png" alt="plot meg data example" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using pyvista 3d backend.
</pre></div>
</div>
</section>
<section id="comparision-with-sloreta">
<h2>Comparision with sLORETA<a class="headerlink" href="#comparision-with-sloreta" title="Permalink to this headline">¶</a></h2>
<p>Now, we compare the results derived from cd-MTLasso with the solution
obtained from the one of the most standard approach: sLORETA.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running sLORETA with standard hyper-parameter</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lambda2</span></a> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mi">9</span>
<span class="n">inv</span> <span class="o">=</span> <span class="n">make_inverse_operator</span><span class="p">(</span><span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                            <span class="n">depth</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stc_full</span> <span class="o">=</span> <span class="n">apply_inverse</span><span class="p">(</span><span class="n">evoked</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lambda2</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lambda2</span></a><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sLORETA&#39;</span><span class="p">)</span>
<span class="n">stc_full</span> <span class="o">=</span> <span class="n">stc_full</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Computing threshold taking into account for Bonferroni correction</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_features</span></a> <span class="o">=</span> <span class="n">stc_full</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">correction</span></a> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_features</span></a>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold_no_clust</span></a> <span class="o">=</span> <span class="n">zscore_from_pval</span><span class="p">((</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">correction</span></a><span class="p">)</span>

<span class="c1"># Computing estimated support by sLORETA</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><span class="n">stc_full</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold_no_clust</span></a>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Putting the solution into the format supported by the plotting functions</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sLORETA_solution</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.atleast_2d.html#numpy.atleast_2d" title="numpy.atleast_2d" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span></a><span class="p">(</span><span class="n">stc_full</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">stc</span> <span class="o">=</span> <span class="n">_make_sparse_stc</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sLORETA_solution</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">stc_full</span><span class="o">.</span><span class="n">tmin</span><span class="p">,</span>
                       <span class="n">tstep</span><span class="o">=</span><span class="n">stc_full</span><span class="o">.</span><span class="n">tstep</span><span class="p">)</span>

<span class="c1"># Plotting sLORETA solution</span>
<span class="k">if</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><span class="n">stc</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pos_lims</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold_no_clust</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span>
                     <span class="n">time_viewer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">brain</span><span class="o">.</span><span class="n">show_view</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a><span class="p">)</span>
    <span class="n">brain</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{cond}</span><span class="s1"> - sLORETA&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_meg_data_example_003.png" srcset="../_images/sphx_glr_plot_meg_data_example_003.png" alt="plot meg data example" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Computing inverse operator with 204 channels.
    204 out of 204 channels remain after picking
Selected 204 channels
Whitening the forward solution.
Computing rank from covariance with rank=None
    Using tolerance 2.1e-12 (2.2e-16 eps * 204 dim * 46  max singular value)
    Estimated rank (grad): 64
    GRAD: rank 64 computed from 204 data channels with 0 projectors
    Setting small GRAD eigenvalues to zero (without PCA)
Creating the source covariance matrix
Adjusting source covariance matrix.
Computing SVD of whitened and weighted lead field matrix.
    largest singular value = 2.06293
    scaling factor to adjust the trace = 2.84039e+19 (nchan = 204 nzero = 140)
Preparing the inverse operator for use...
    Scaled noise and source covariance from nave = 1 to nave = 111
    Created the regularized inverter
    The projection vectors do not apply to these channels.
    Created the whitener using a noise covariance matrix with rank 64 (140 small eigenvalues omitted)
    Computing noise-normalization factors (sLORETA)...
[done]
Applying inverse operator to &quot;1&quot;...
    Picked 204 channels from the data
    Computing inverse...
    Eigenleads need to be weighted ...
    Computing residual...
    Explained  95.4% variance
    sLORETA...
[done]
</pre></div>
</div>
</section>
<section id="analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#analysis-of-the-results" title="Permalink to this headline">¶</a></h2>
<p>While the clustered inference solution always highlights the expected
cortex (audio, visual or somato-sensory) with a universal predertemined
threshold, the solution derived from the sLORETA method does not enjoy
the same property. For the audio task the method is conservative and
for the somato task the method makes false discoveries (then it seems
anti-conservative).</p>
</section>
<section id="running-ensemble-clustered-inference">
<h2>Running ensemble clustered inference<a class="headerlink" href="#running-ensemble-clustered-inference" title="Permalink to this headline">¶</a></h2>
<p>To go further it is possible to run the ensemble clustered inference
algorithm. It might take several minutes on standard device with
<code class="docutils literal notranslate"><span class="pre">n_jobs=1</span></code> (around 10 min). Just set
<code class="docutils literal notranslate"><span class="pre">run_ensemble_clustered_inference=True</span></code> below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">run_ensemble_clustered_inference</span></a> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">run_ensemble_clustered_inference</span></a><span class="p">:</span>
    <span class="c1"># Making the inference with the ensembled clustered inference algorithm</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">beta_hat</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval_corr</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval_corr</span></a> <span class="o">=</span> \
        <span class="n">ensemble_clustered_inference</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Y</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.FeatureAgglomeration.html#sklearn.cluster.FeatureAgglomeration" title="sklearn.cluster.FeatureAgglomeration" class="sphx-glr-backref-module-sklearn-cluster sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ward</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_clusters</span></a><span class="p">,</span>
                                     <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inference_method</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inference_method</span></a><span class="p">)</span>

    <span class="c1"># Extracting active set (support)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval_corr</span></a> <span class="o">&lt;</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                               <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval_corr</span></a> <span class="o">&lt;</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fwer_target</span></a> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set_full</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.copy.html#numpy.copy" title="numpy.copy" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">copy</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set_full</span></a><span class="p">[:]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Translating p-vals into z-scores for nicer visualization</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore</span></a> <span class="o">=</span> <span class="n">zscore_from_pval</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pval</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_minus_pval</span></a><span class="p">)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore</span></a><span class="p">[</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">]</span>

    <span class="c1"># Putting the solution into the format supported by the plotting functions</span>
    <span class="n">stc</span> <span class="o">=</span> <span class="n">_compute_stc</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_active_set</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="p">,</span> <span class="n">evoked</span><span class="p">,</span> <span class="n">forward</span><span class="p">)</span>

    <span class="c1"># Plotting ensemble clustered inference solution</span>
    <span class="k">if</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">active_set</span></a><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stc</span><span class="o">.</span><span class="n">_data</span></a><span class="p">))</span>
        <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pos_lims</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">zscore_threshold</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">max_stc</span></a><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="p">,</span>
                         <span class="n">subjects_dir</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span> <span class="n">time_viewer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">brain</span><span class="o">.</span><span class="n">show_view</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">view</span></a><span class="p">)</span>
        <span class="n">brain</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{cond}</span><span class="s1"> - ecd-MTLasso (AR1)&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">interactive_plot</span></a> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">interactive_plot</span></a><span class="p">:</span>
            <span class="n">brain</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hemi</span></a><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                             <span class="n">subjects_dir</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">subs_dir</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clim</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  5.589 seconds)</p>
<p><strong>Estimated memory usage:</strong>  380 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-meg-data-example-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/40ce49ab7b480411ab9e56d71bcdd62a/plot_meg_data_example.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_meg_data_example.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/7cbfcab774b8bf1a8e00abab1ae4da8d/plot_meg_data_example.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_meg_data_example.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Jerome-Alexis Chevalier &amp; Binh Nguyen.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>